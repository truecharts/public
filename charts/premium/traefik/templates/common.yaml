{{/* Make sure all variables are set properly */}}
{{- include "tc.v1.common.loader.init" . }}

{{- $newArgs :=  (include "traefik.args" . | fromYaml) }}
{{- $_ := set .Values "newArgs" $newArgs -}}
{{- $mergedargs := concat $.Values.workload.main.podSpec.containers.main.args .Values.newArgs.args }}
{{- $_ := set $.Values.workload.main.podSpec.containers.main "args" $mergedargs -}}

{{- include "traefik.portalhook" . }}
{{- include "traefik.tlsstore" . }}
{{- include "traefik.tlsOptions" . }}
{{- include "traefik.ingressRoute" . }}
{{- include "traefik.ingressClass" . }}

{{- with .Values.ingress -}}
  {{- with .main -}}
    {{- if .enabled  -}}
      {{- $_ := set $.Values.portal.open.override "protocol" "https" -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{/* Render the templates */}}
{{ include "tc.v1.common.loader.apply" . }}
