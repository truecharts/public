image:
  repository: ghcr.io/authelia/authelia
  pullPolicy: IfNotPresent
  tag: 4.38.19@sha256:46021dc20efdcc5cdc38a29e3050b8835429a155ae6215388ed3b793a02eb0ab

# Raw Authelia configuration
secret:
  authelia-configfile:
    enabled: true
    data:
      configuration.yaml: |
        ###############################################################
        ##                  Place your config below                  ##
        ###############################################################

workload:
  main:
    replicas: 2
    strategy: RollingUpdate
    podSpec:
      containers:
        main:
          command:
            - authelia
          args:
            - --config=/configuration.yaml
          env:
            AUTHELIA_AUTHENTICATION_BACKEND_FILE_PATH: "/config/users_database.yml"
            AUTHELIA_SERVER_ADDRESS: "tcp://:{{ .Values.service.main.ports.main.port }}/"
            AUTHELIA_STORAGE_POSTGRES_ADDRESS: "tcp://{{ .Values.cnpg.main.creds.host }}:{{ .Values.cnpg.main.creds.port }}"
            AUTHELIA_STORAGE_POSTGRES_DATABASE: "{{ .Values.cnpg.main.database }}"
            AUTHELIA_STORAGE_POSTGRES_USERNAME: "{{ .Values.cnpg.main.user }}"
            AUTHELIA_STORAGE_POSTGRES_PASSWORD: "{{ .Values.cnpg.main.password }}"
            AUTHELIA_SESSION_REDIS_HOST: "{{ .Values.redis.creds.plain }}"
            AUTHELIA_SESSION_REDIS_PORT: "{{ .Values.redis.service.main.ports.main.port }}"

          probes:
            liveness:
              type: http
              path: "/api/health"
            readiness:
              type: http
              path: "/api/health"
            startup:
              type: http
              path: "/api/health"
service:
  main:
    ports:
      main:
        port: 9091

persistence:
  config:
    enabled: true
    mountPath: /config
  authelia-configfile:
    enabled: true
    mountPath: /configuration.yaml
    subPath: configuration.yaml
    readOnly: true
    type: configmap
    objectName: authelia-configfile

cnpg:
  main:
    enabled: true
    user: authelia
    database: authelia

# Enabled redis
# ... for more options see https://github.com/tccr.io/truecharts/charts/tree/master/tccr.io/truecharts/redis
redis:
  enabled: true
  includeCommon: true

portal:
  open:
    enabled: true

ingress:
  main:
    required: true
