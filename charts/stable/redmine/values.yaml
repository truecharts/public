image:
  repository: tccr.io/truecharts/redmine
  pullPolicy: IfNotPresent
  tag: 5.0.4@sha256:d1c1d5d4560e9165491d7691f3b0f617536b4b6fda2896d38d67e87cd81c71a7
redmine:
  plugins_migrate: true
  no_db_migrate: false
service:
  main:
    ports:
      main:
        port: 10171
        targetPort: 3000
persistence:
  data:
    enabled: true
    mountPath: "/usr/src/redmine/files"
# Enabled postgres
cnpg:
  main:
    enabled: true

    user: redmine
    database: redmine
portal:
  open:
    enabled: true
securityContext:
  container:
    readOnlyRootFilesystem: false
workload:
  main:
    podSpec:
      containers:
        env:
          REDMINE_DB_DATABASE: "{{ .Values.cnpg.main.database }}"
          REDMINE_DB_USERNAME: "{{ .Values.cnpg.main.user }}"
          REDMINE_DB_PORT: "5432"
          # Anything but empty means true, empty means false
          REDMINE_NO_DB_MIGRATE: '{{ ternary "true" "" .Values.redmine.no_db_migrate }}'
          REDMINE_PLUGINS_MIGRATE: '{{ ternary "true" "" .Values.redmine.plugins_migrate }}'
          REDMINE_DB_PASSWORD:
            secretKeyRef:
              name: cnpg-main-urls
              key: postgresql-password
          REDMINE_DB_POSTGRES:
            secretKeyRef:
              name: cnpg-main-urls
              key: plainhost
          REDMINE_SECRET_KEY_BASE:
            secretKeyRef:
              name: redmine-secrets
              key: REDMINE_SECRET_KEY_BASE
