image:
  repository: netdata/netdata
  tag: v1.34.1@sha256:04494e001fc6854eb86dd6d53f8194554d3919652ea36d6f75c8f5974de05e1d
  pullPolicy: IfNotPresent

securityContext:
  # readOnlyRootFilesystem: false
  runAsNonRoot: true
  capabilities:
    add:
      - SYS_PTRACE

podSecurityContext:
  runAsUser: 201
  runAsGroup: 201
  fsGroup: 201

serviceAccount:
  create: true

rbac:
  enabled: true
  rules:
  - apiGroups:
    - ""
    resources:
      - "pods"
      - "services"
      - "configmaps"
      - "secrets"
      - "nodes"
      - "nodes/metrics"
    verbs:
      - "get"
      - "list"
      - "watch"
  - apiGroups: [""]
    resources:
      - "namespaces"
    verbs:
      - "get"

envValueFrom:
  MY_NODE_NAME:
    fieldRef:
      fieldPath: spec.nodeName
  MY_POD_NAMESPACE:
    fieldRef:
      fieldPath: metadata.namespace
  MY_POD_NAME:
    fieldRef:
      fieldPath: metadata.name

service:
  main:
    ports:
      main:
        port: 19999
        targetPort: 19999

probes:
  liveness:
    path: "/api/v1/info"
  readiness:
    path: "/api/v1/info"
  startup:
    path: "/api/v1/info"

persistence:
  config:
    enabled: true
    mountPath: "/etc/netdata"
  lib:
    enabled: true
    mountPath: "/var/lib/netdata"
  cache:
    enabled: true
    mountPath: "/var/cache/netdata"
  passwd:
    enabled: true
    type: hostPath
    hostPath: "/etc/passwd"
    mountPath: "/host/etc/passwd"
    readOnly: true
  group:
    enabled: true
    type: hostPath
    hostPath: "/etc/group"
    mountPath: "/host/etc/group"
    readOnly: true
  proc:
    enabled: true
    type: hostPath
    hostPath: "/proc"
    mountPath: "/host/proc"
    readOnly: true
  sys:
    enabled: true
    type: hostPath
    hostPath: "/sys"
    mountPath: "/host/sys"
    readOnly: true
  os:
    enabled: true
    type: hostPath
    hostPath: "/etc/os-release"
    mountPath: "/host/etc/os-release"
    readOnly: true

initContainers:
  create-config:
    name: create-config
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    volumeMounts:
    - name: config
      mountPath: "/etc/netdata"
    command: ["/bin/sh", "-c"]
    args:
      - >
        export configfile=/etc/netdata/netdata.conf;
        if [ ! -f $configfile ]; then
          echo "Creating config file...";
          echo '[global]' > $configfile;
          echo '  memory mode = dbengine' >> $configfile;
          echo '  dbengine multihost disk space = 4096' >> $configfile;
          echo '  page cache size = 64' >> $configfile;
        else
          echo "Config file exists, skipping...";
        fi;
